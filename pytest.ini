[pytest]
# Enterprise Testing Configuration for Tools Package
# ==================================================
#
# This configuration provides enterprise-grade pytest settings
# optimized for scalability, reliability, and comprehensive testing.

# Test Discovery
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Test Execution
minversion = 7.0
addopts = 
    # Output options
    --verbose
    --tb=short
    --strict-markers
    --strict-config
    
    # Coverage options
    --cov=ice_pipeline
    --cov-report=term-missing
    --cov-report=html:reports/coverage
    --cov-report=xml:reports/coverage.xml
    --cov-report=json:reports/coverage.json
    --cov-branch
    --cov-fail-under=78
    
    # Test execution options
    --maxfail=10
    --timeout=300
    --tb=short
    --capture=no
    
    # Performance and resource options
    --durations=10
    --durations-min=1.0
    
    # Output formatting
    --color=yes
    --code-highlight=yes
    
    # Warnings configuration
    --disable-warnings
    --strict-markers
markers =
    # Test Categories
    unit: Unit tests for individual components
    integration: Integration tests for component interaction
    api: API endpoint tests
    e2e: End-to-end user workflow tests
    performance: Performance and load tests
    stress: Stress tests with heavy load
    security: Security-related tests
    business: Business logic validation tests
    
    # Test Priorities
    smoke: Critical smoke tests for basic validation
    regression: Regression tests for bug prevention
    acceptance: User acceptance tests
    
    # Test Characteristics
    slow: Tests that take more than 30 seconds
    fast: Tests that complete in under 1 second
    flaky: Tests that may fail intermittently
    experimental: Experimental or beta features
    
    # Environment Specific
    local: Tests that run only in local environment
    ci: Tests optimized for CI environment
    staging: Tests for staging environment
    production: Production validation tests
    
    # Database Related
    database: Tests requiring database connection
    postgres: PostgreSQL specific tests
    redis: Redis specific tests
    mongodb: MongoDB specific tests
    
    # External Dependencies
    external_api: Tests calling external APIs
    google_drive: Google Drive integration tests
    file_processing: File processing tests
    
    # ICE Pipeline Specific
    ice_core: Core ICE pipeline functionality
    ice_ingestion: Data ingestion tests
    ice_processing: Data processing tests
    ice_validation: Data validation tests
    ice_export: Data export tests
    
    # Quality Assurance
    coverage: Coverage-related tests
    memory: Memory usage tests
    cpu_intensive: CPU-intensive tests
    
    # Enterprise Features
    audit: Audit trail tests
    compliance: Compliance validation tests
    scalability: Scalability tests
    monitoring: Monitoring and alerting tests

    # Additional Test Markers
    error_handling: Error handling and exception tests
    edge_cases: Edge case and boundary condition tests
    api_coverage: API coverage tests
    api_integration: API integration tests

# Test Timeout Configuration
timeout = 300
timeout_method = thread

# Parallel Testing
# Use with: pytest -n auto (requires pytest-xdist)
# addopts_parallel =
#     --maxprocesses=auto
#     --dist=loadscope

# Coverage Configuration
[coverage:run]
source = ice_pipeline
omit = 
    */tests/*
    */test_*
    */__pycache__/*
    */migrations/*
    */venv/*
    */virtualenv/*
    */.tox/*
    */setup.py
    */conftest.py
branch = true
parallel = true

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstract
skip_covered = false
show_missing = true
precision = 2

[coverage:html]
directory = reports/coverage
title = ICE Pipeline Test Coverage Report

[coverage:xml]
output = reports/coverage.xml

[coverage:json]
output = reports/coverage.json
pretty_print = true